## THis was an expiremental deploy to test cosine similarity result

resource "google_storage_bucket" "bucket_2" {
  project                     = var.app_project_id
  name                        = "extraction-index-${var.env}-2"
  location                    = var.region
  uniform_bucket_level_access = true
  labels                      = var.labels
}

# # The sample data comes from the following link:
# # https://cloud.google.com/vertex-ai/docs/matching-engine/filtering#specify-namespaces-tokens
# resource "google_storage_bucket_object" "extraction_index_sample_data_2" {
#   name    = "contents/data.json"
#   bucket  = google_storage_bucket.bucket_2.name
#   content = <<EOF
#     {"id": "42", "embedding": [0.011823455803096294, -0.011165927164256573, -0.024313392117619514, 0.027722518891096115, 0.03257032483816147, 0.01954467035830021, 0.010053441859781742, 0.017636653035879135, 0.007754849269986153, -0.003613436361774802, 0.003036373294889927, 0.018329763785004616, -0.019314296543598175, -0.06128212437033653, -0.04703915864229202, -0.0063876197673380375, -0.05653694272041321, -0.027802864089608192, 0.02026395872235298, 0.05553463101387024, -0.0435720831155777, 0.020066769793629646, 0.002921788254752755, 0.029122406616806984, -0.03137117624282837, -0.06479176133871078, 0.001975658116862178, -0.00663775997236371, -0.01064485963433981, 0.0026525985449552536, -0.01560062263160944, -0.03378092870116234, -0.06346508115530014, -0.02556704729795456, 0.006721229758113623, 0.026835013180971146, -0.011881981045007706, 0.007505887653678656, -0.019694475457072258, 0.03520588204264641, 0.024885645136237144, -0.023556137457489967, -0.020104076713323593, 0.02238590084016323, 0.0004379399761091918, 0.016652368009090424, 0.010240544565021992, 0.055076342076063156, -0.021488115191459656, -0.06518851220607758, 0.03420135751366615, 0.001297926064580679, -0.0017890280578285456, -0.03417467325925827, 0.04812533035874367, 0.024699054658412933, -0.039945244789123535, -0.035328544676303864, -0.049977388232946396, 0.03620791435241699, -0.023380370810627937, 0.005317654926329851, 0.012979536317288876, -0.03627154976129532, -0.0564994141459465, 0.09352094680070877, 0.027212820947170258, -0.01734788715839386, 0.02387663908302784, -0.027771977707743645, 0.034435734152793884, 0.04249437153339386, -0.021889401599764824, -0.006053539924323559, 0.0471002422273159, 0.012913708575069904, 0.020295126363635063, 0.012177112512290478, 0.04037463665008545, -0.061780910938978195, 0.025467578321695328, -0.03141280636191368, -0.057324234396219254, -0.08100920915603638, -0.018765676766633987, 0.017307139933109283, 0.03264772146940231, 0.06282112002372742, -0.0716569572687149, 0.08163437247276306, -0.0491793118417263, 0.0026893308386206627, 0.006262078881263733, 0.0379701629281044, -0.05371337756514549, -0.0059340354055166245, -0.019079316407442093, 0.0106135169044137, -0.0017235844861716032, -0.03774295002222061, -0.004102738108485937, -0.0464751273393631, 0.074942447245121, -0.0591479055583477, 0.02366565726697445, -0.00509256636723876, -0.006309658754616976, 0.060695551335811615, -0.012991506606340408, -0.09453650563955307, -0.07552728056907654, 0.00919493380934, -0.006316280923783779, 0.011878198944032192, -0.030438710004091263, -0.055183809250593185, 0.03464726731181145, 0.014314737170934677, 0.029237374663352966, 0.023891860619187355, -0.056569453328847885, -0.012428779155015945, -0.004970131907612085, 0.02152400277554989, 0.005136045161634684, 0.03789922595024109, 0.03889930620789528, 0.01086817029863596, -0.005005733575671911, -0.026572559028863907, 0.03833460062742233, -0.0030047965701669455, 0.05477018281817436, -0.03206304833292961, 0.020386002957820892, 0.030234813690185547, 0.013201462104916573, 0.010896244086325169, -0.01494473498314619, -0.019620800390839577, -0.07229579985141754, 0.010234669782221317, 0.021302973851561546, 0.05898311734199524, -0.023850878700613976, -0.015221023000776768, -0.01276881992816925, 0.0006195802125148475, -0.012817969545722008, -0.02026427909731865, -0.007949761115014553, -0.020542612299323082, -0.01698712445795536, 0.020629504695534706, 0.04641120880842209, 0.0716855451464653, 0.0669604167342186, 0.051431894302368164, 0.003908179700374603, -0.05337801203131676, 0.05593852326273918, -0.01846831850707531, -0.016687415540218353, -0.013204245828092098, 0.045881424099206924, 0.026192259043455124, 0.0007431100239045918, 0.006410615984350443, -0.009344130754470825, -0.025133471935987473, 0.09667086601257324, -0.14442403614521027, 0.007105161435902119, 0.022240564227104187, 0.11228694766759872, 0.007696362677961588, -0.0470709390938282, 0.06347883492708206, 0.04807857796549797, -0.050725337117910385, 0.0010414283024147153, -0.03473896160721779, 0.06855862587690353, -0.04948357492685318, -0.04494432359933853, -0.01999843306839466, 0.022517099976539612, -0.043402157723903656, -0.0561634786427021, 0.05128994956612587, -0.005337718408554792, 0.019281283020973206, -0.03156764432787895, -0.033387478440999985, -0.01725027896463871, 0.0003695647174026817, 0.06792990118265152, -0.12648636102676392, 0.011530210264027119, 0.02157844416797161, 0.017915397882461548, -0.05702482908964157, 0.012424829415977001, -0.0018849748885259032, -0.027803143486380577, -0.03356224298477173, -0.016700034961104393, 0.041333384811878204, 0.04014027863740921, -7.512030424550176e-05, -0.010080414824187756, 0.024422964081168175, 0.013052089139819145, -0.019354619085788727, 0.007631175220012665, 0.0055975173600018024, 0.0558667927980423, -0.07506049424409866, -0.053131140768527985, 0.0009128999663516879, -0.005464754067361355, 0.008912560530006886, 0.05290748178958893, 0.01167235616594553, 0.01916257105767727, 0.03126896917819977, 0.04505476355552673, 0.026661576703190804, -0.03210487589240074, 0.013269778341054916, -0.010275273583829403, -0.041378676891326904, -0.03607119247317314, 0.025260673835873604, 0.040465209633111954, 0.03967741131782532, 0.002017758786678314, 0.039369553327560425, -0.08034482598304749, 0.025927139446139336, 0.03874267637729645, 0.05286131799221039, -0.014666099101305008, -0.027118682861328125, -0.04922524839639664, 0.045155931264162064, -0.05595451965928078, 0.04079928994178772, 0.014413573779165745, -0.008047312498092651, 0.03423681855201721, -0.07193586230278015, -0.0236961729824543, 0.02945350855588913, 0.061214130371809006, -0.000924714608117938, -0.0009221119689755142, 0.0045198784209787846, -0.0358174629509449, -0.02287905290722847, 0.022804543375968933, 0.018025698140263557, 0.06253020465373993, 0.1577819585800171, -0.009616512805223465, -0.037979573011398315, -0.014541306532919407, -0.035427797585725784, 0.04296424239873886, -0.0351203978061676, -0.02767845429480076, -0.035382479429244995, 0.04085594415664673, 0.04230351373553276, 0.017365021631121635, -0.00020074505300726742, -0.007270935457199812, 0.042628929018974304, 0.02692624181509018, 0.039368633180856705, 0.037432122975587845, -0.05646362528204918, 0.01807263307273388, 0.03321719542145729, 0.009904498234391212, 0.0004780188901349902, 0.01573503203690052, -0.04080723971128464, -0.037216853350400925, -0.03866319730877876, 0.057040948420763016, 0.010562724433839321, -0.009782467968761921, 0.04905487596988678, -0.01561257615685463, 0.03258378431200981, 0.03749985620379448, -0.035595376044511795, -0.04034845903515816, 0.022450076416134834, -0.01754830591380596, -0.000597616657614708, -0.020278936251997948, 0.025553645566105843, -0.061875950545072556, -0.020556055009365082, 0.004611807409673929, 0.00366753782145679, 0.03332224488258362, -0.04168999195098877, 0.00735242897644639, 0.04147621616721153, 0.042539097368717194, 0.06132669746875763, -0.04029196500778198, 0.030812639743089676, 0.06701739877462387, -0.0411357656121254, -0.042825303971767426, 0.06434283405542374, -0.022523296996951103, 0.012160473503172398, 0.049593448638916016, 0.012888823635876179, 0.029658615589141846, 3.194945020368323e-05, -0.018317947164177895, -0.02308250032365322, 0.07185699045658112, -0.052529990673065186, -0.008848199620842934, -0.00036075260140933096, -0.026134535670280457, -0.0015547669027000666, -0.0013563894899562001, 0.024816757068037987, -0.00938434712588787, 0.020750446245074272, -0.023227449506521225, -0.06513701379299164, -0.015617530792951584, 0.008289100602269173, -0.06004844978451729, -0.018058093264698982, -0.06540346890687943, 0.047802072018384933, -0.036316145211458206, -0.014958408661186695, -0.03916745260357857, -0.05570197105407715, -0.029929228127002716, -0.0016690157353878021, 0.01913193054497242, 0.05019254609942436, 0.06314022839069366, -0.016917403787374496, -0.022127892822027206, 0.028703274205327034, 0.02134343422949314, 0.00743787782266736, -0.03575361520051956, 0.001401828252710402, -0.039347875863313675, 0.01846475712954998, 0.014163983054459095, -0.0042692068964242935, -0.06244119256734848, -0.02679537609219551, 0.027202105149626732, 0.025458570569753647, 0.0010766797931864858, -0.016564270481467247, 0.02066406048834324, -0.018067797645926476, -0.07478217780590057, -0.02956072799861431, 0.0018545460188761353, -0.040719226002693176, -0.011481327004730701, 0.028495866805315018, 0.013772251084446907, -0.0013799857115373015, -0.032806217670440674, -0.008490334264934063, 0.005647878162562847, -0.021845616400241852, 0.019829677417874336, 0.03608837351202965, -0.000405936996685341, -0.04575858637690544, 0.007845093496143818, 0.06271795183420181, 0.004445584956556559, -0.02687113732099533, 0.01574036292731762, 0.045714616775512695, 0.00482805585488677, -0.006368724629282951, -0.011373918503522873, 0.004070849623531103, 0.038088321685791016, 0.010473993606865406, -0.005061939358711243, -0.09629311412572861, 0.008864562958478928, -0.0030503992456942797, 0.006276807282119989, 0.04490629956126213, 0.018124721944332123, -0.015801332890987396, 0.014604469761252403, -0.06240662559866905, -0.037015609443187714, 0.021759171038866043, -0.027016006410121918, 0.010310947895050049, 0.02705833688378334, -0.06629712134599686, 0.0037699691019952297, -0.033841174095869064, 0.08999978005886078, -0.014596106484532356, -0.04367291182279587, 0.02576463110744953, -0.0056685833260416985, -0.02495981752872467, -0.05757277458906174, 0.014808248728513718, -0.0394834466278553, 0.027199434116482735, 0.017645802348852158, -0.001958063803613186, 0.03319394960999489, -0.07227670401334763, -0.02244194783270359, -0.08314027637243271, 0.10571947693824768, 0.04540112242102623, 0.03817399963736534, -0.046630728989839554, -0.017473170533776283, 0.027954192832112312, -0.07760843634605408, 0.04757899045944214, 0.006024498958140612, -0.05499919503927231, -0.02439693547785282, 0.015668978914618492, -0.0019228862365707755, -0.01815684698522091, 0.026195239275693893, 0.02088082954287529, 0.0033530117943882942, 0.10368693619966507, 0.0026928780134767294, 0.03490142524242401, -0.05415785312652588, 0.013981214724481106, 0.027718814089894295, 0.019346041604876518, -0.013286379165947437, 0.01743355393409729, -0.05255453661084175, 0.06872344762086868, 0.0187970120459795, -0.03401212394237518, 0.019006796181201935, -0.006664683576673269, -0.018987437710165977, 0.016551731154322624, -0.04149942100048065, 0.004702859558165073, 0.02422536164522171, -0.03242230787873268, 0.03477538004517555, -0.02806386537849903, 0.014708880335092545, 0.04238584637641907, -0.036969173699617386, -0.0017134509980678558, -0.054305631667375565, -0.04681555926799774, 0.02199445851147175, -0.02667139284312725, 0.07797085493803024, 0.04842366278171539, 0.02259058877825737, 0.0025428354274481535, -0.04538118094205856, -0.01086905226111412, 0.01916876621544361, -0.029843322932720184, -0.006729481276124716, 0.006705476902425289, 0.017368821427226067, -0.016421537846326828, -0.009649406187236309, 0.025737782940268517, 0.043564192950725555, 0.019849391654133797, 0.019010795280337334, -0.03765084221959114, 0.004500280600041151, -0.03985685482621193, 0.002169882645830512, 0.009665200486779213, 0.02778843604028225, -0.03342322260141373, -0.04369056969881058, 0.0084917563945055, 0.005273561459034681, 0.03815525770187378, -0.030394889414310455, -0.07232776284217834, 0.0005256221629679203, -0.07629204541444778, 0.01554459985345602, 0.01929571107029915, 0.02944651059806347, -0.0018215071177110076, -0.017497066408395767, -0.04423055797815323, -0.02944329008460045, 0.002141448901966214, 0.049595907330513, 0.03321433067321777, 0.020859481766819954, -0.022870687767863274, -0.012988499365746975, -0.03664669021964073, 0.0040172431617975235, -0.0027413126081228256, -0.0182297695428133, 0.0022320144344121218, 0.004503832198679447, -0.038572922348976135, 0.033944256603717804, -0.0013675858499482274, 0.019317282363772392, 0.06914412975311279, -0.043299268931150436, -0.017638927325606346, 0.013398410752415657, 0.07955078780651093, 0.04166921600699425, 0.015527910552918911, 0.03843671455979347, 0.023760847747325897, 0.03959675133228302, 0.02656489983201027, 0.043499916791915894, -0.04668216407299042, -0.034132588654756546, 0.04659629985690117, 0.03749024495482445, -0.02275538258254528, 0.0014701099134981632, -0.003124064998701215, -0.019125720486044884, -0.003814798779785633, 0.014213619753718376, 0.03358080983161926, 0.018243104219436646, 0.039998576045036316, 0.07643459737300873, -0.008734112605452538, 0.028443897143006325, 0.007106582634150982, 0.008786287158727646, 0.060307394713163376, -0.05515218526124954, 0.007215837482362986, -0.03351857513189316, -0.011822865344583988, 0.006549942307174206, 0.052164625376462936, -0.025860246270895004, -0.020927224308252335, 0.03904923424124718, -0.0057283975183963776, 0.017069142311811447, 0.005709962919354439, 0.0030151987448334694, 0.005050587933510542, -0.03558697551488876, 0.003194462275132537, -0.04294341802597046, -0.03235297277569771, -0.02350972406566143, -0.027844909578561783, -0.015779701992869377, -0.025717049837112427, -0.017516763880848885, 0.003605501726269722, -0.09216344356536865, -0.03488680347800255, -0.02498643472790718, -0.0565577931702137, 0.03665921464562416, -0.014069689437747002, -0.04746507480740547, 0.02744739130139351, 0.07712187618017197, -0.03611638396978378, 0.002149933250620961, 0.010590735822916031, 0.044095687568187714, 0.007994713261723518, 0.014629588462412357, -0.0010246280580759048, -0.03160892799496651, 0.031146535649895668, 0.024206146597862244, 0.017283910885453224, -0.0030933539383113384, 0.0031755538657307625, -0.04654981940984726, 0.09070546925067902, 0.010005372576415539, -0.02361520566046238, 0.021260853856801987, 0.011737590655684471, -0.001331682433374226, -0.052028313279151917, 0.008343934081494808, -0.04238048940896988, -0.050908129662275314, 0.007256433367729187, -0.004504560958594084, -0.02320370450615883, 0.020094819366931915, -0.001443249173462391, -0.047195568680763245, -0.0655474066734314, -0.04444437474012375, 0.0003115265863016248, 0.0237681083381176, 0.00238867592997849, 0.016447078436613083, 0.019547495990991592, 0.05080178380012512, 0.01605050265789032, -0.011829882860183716, -0.014993580989539623, 0.014436372555792332, 0.017401231452822685, -0.02957320213317871, -0.05412059277296066, -0.017707087099552155, 0.05442504584789276, 0.009379599243402481, -0.03554046154022217, 0.029171425849199295, -0.03551753610372543, 0.02573508769273758, -0.008242352865636349, -0.007989133708178997, 0.01071710791438818, 0.00695346063002944, -0.006692057475447655, 0.06127293407917023, -0.007953392341732979, 0.03356035053730011, 0.07925444096326828, -0.031344786286354065, 0.06696256995201111, -0.03008875623345375, 0.03397100418806076, 0.025311008095741272, 0.030017660930752754, -0.004562154412269592, -0.0283474400639534, 0.0843966007232666, -0.05105538293719292, -0.010179189965128899, -0.006598260719329119, -0.0013321678852662444, 0.039894264191389084, -0.0021022900473326445, 0.025417257100343704, -0.05212949588894844, -0.015653563663363457, -0.016059085726737976, -0.007874461822211742, 0.01627529226243496, -0.024899635463953018, 0.017415788024663925, -0.017962265759706497, -0.010197206400334835, -0.005745668895542622, 0.009106811136007309, 0.009519691579043865, -0.02140670455992222, -0.021033182740211487, 0.005144968628883362, -0.03350338712334633, -0.03993424400687218, -0.016118766739964485, 0.015698350965976715, -0.007589688058942556, -0.037998687475919724, 0.022735118865966797, 0.03777407109737396, 0.041192274540662766, 0.027286868542432785, -0.011140843853354454, -0.010565216653048992, -0.0017537702806293964, -0.02088354527950287, -0.02611854113638401, -0.007178458385169506, 0.02826801687479019, 0.05256073549389839, 0.025832898914813995, -0.005078003276139498, 0.04575098678469658, -0.03038496896624565, -0.02197231538593769, -0.01952030323445797, -0.016174569725990295, -0.02889196388423443, 0.03838051110506058, -0.028551815077662468, -0.007384405937045813, -0.023270701989531517, -0.02045963518321514, 0.07204064726829529, -0.02123350277543068, -0.03304634243249893, 0.02739223837852478, 0.0008371936855837703, -0.04893989488482475, 0.07438580691814423, 0.040181320160627365, 0.0038002703804522753, -0.016595279797911644, 0.04842033237218857, -0.03790724277496338, 0.0598905049264431, -0.05266761779785156, -0.012534945271909237, -0.009383754804730415, -0.004786437377333641, -0.00014298970927484334, 0.0178951658308506, 0.018480785191059113, 0.005649566184729338, -0.06234513968229294, 0.03051239252090454, -0.04019768163561821, -0.07983914762735367, 0.0031543283257633448, -0.021969174966216087, -0.011206706054508686, -0.001209819340147078, 0.06744632124900818, -0.015408705919981003, 0.07325738668441772, -0.009776473045349121, 0.01958809606730938, -0.0027416320517659187, -0.0034502914641052485, -0.019052036106586456, -0.02767889015376568, 0.02871786244213581, 0.03571084886789322, -0.023553799837827682, -0.030924102291464806], "restricts": [{"namespace": "class", "allow": ["cat", "pet"]},{"namespace": "category", "allow": ["feline"]}]}
#     EOF
# }

# resource "google_vertex_ai_index" "extraction_index_2" {
#   labels = {
#     index_name = "extraction-index-${var.env}-2"
#   }
#   region       = var.region
#   project      = var.app_project_id
#   display_name = "extraction-index-${var.env}-2"
#   description  = "index for transcript extraction related use cases"
#   metadata {
#     contents_delta_uri = "gs://${google_storage_bucket.bucket_2.name}/contents"
#     config {
#       dimensions                  = 768
#       approximate_neighbors_count = 150
#       shard_size                  = var.extraction_vertex_ai_index_size
#       distance_measure_type       = "COSINE_DISTANCE"
#       feature_norm_type           = "UNIT_L2_NORM"
#       algorithm_config {
#         tree_ah_config {
#           leaf_node_embedding_count    = 500
#           leaf_nodes_to_search_percent = 80
#         }
#       }
#     }
#   }
#   index_update_method = "STREAM_UPDATE"
#   depends_on          = [google_storage_bucket.bucket_2]
# }

# resource "google_vertex_ai_index_endpoint" "extraction_index_endpoint_2" {
#   project                 = var.app_project_id
#   display_name            = "extraction-index-endpoint-2"
#   description             = "A sample vertex endpoint with an public endpoint"
#   region                  = var.region
#   public_endpoint_enabled = true
# }

# # Manually deploy index to endpoint using gcp console. Hopefully 
# # there is a TF module for the same in future

# output "extraction_index_id_2" {
#   value = google_vertex_ai_index.extraction_index_2.id
# }

# output "extraction_index_endpoint_2" {
#   value = google_vertex_ai_index.extraction_index_2.deployed_indexes[0].index_endpoint
# }

# output "extraction_deployed_index_id_2" {
#   value = google_vertex_ai_index.extraction_index_2.deployed_indexes[0].deployed_index_id
# }
